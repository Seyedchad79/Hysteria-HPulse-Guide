# راهنمای جامع و حرفه‌ای راه‌اندازی تانل Hysteria با اسکریپت HPulse

این ریپازیتوری یک فورک از پروژه اصلی [Erfan-XRay/HPulse](https://github.com/Erfan-XRay/HPulse) است که با یک راهنمای کامل و قدم به قدم برای نصب، پیکربندی و درک مفاهیم غنی‌سازی شده است.

---

## 🎯 فصل ۱: آماده‌سازی و پیش‌نیازها

> **نکته کلیدی:** موفقیت‌آمیز بودن کل فرآیند به آماده‌سازی صحیح این مرحله بستگی دارد.

1.  **دو سرور مجازی (VPS):**
    * **سرور خارجی (Edge):** یک سرور خارج از ایران (مانند آلمان) با سیستم‌عامل **Ubuntu 22.04**.
    * **سرور داخلی (Gateway):** یک سرور داخل ایران با سیستم‌عامل **Ubuntu 22.04**.

2.  **یک دامنه (Domain):**
    * یک زیردامنه (مثلاً `tunnel.yourdomain.com`) بسازید.
    * در پنل **Cloudflare**، یک رکورد `A` ایجاد کنید که این زیردامنه را به **IP سرور خارجی** شما اشاره دهد.

> **⚠️ هشدار مهم:** پراکسی Cloudflare (ابر نارنجی 🟧) برای این رکورد باید **خاموش (DNS Only 🩶)** باشد تا گواهی SSL به درستی دریافت شود.

---

## 🚀 فصل ۲: نصب و اجرای اسکریپت HPulse

در **هر دو سرور** (داخلی و خارجی)، دستور زیر را برای دانلود و اجرای اسکریپت HPulse اجرا کنید.

```bash
bash <(curl -fsSL [https://raw.githubusercontent.com/Erfan-XRay/HPulse/main/HPulse.sh](https://raw.githubusercontent.com/Erfan-XRay/HPulse/main/HPulse.sh))
🌍 فصل ۳: پیکربندی سرور خارجی (Edge Server)
در ترمینال سرور خارجی، گزینه 1. Install Hysteria As A Server را انتخاب کنید.

انتخاب حالت نصب:

گزینه 1. Strict را انتخاب کنید. این حالت امن‌تر است.

وارد کردن اطلاعات:

Domain: دامنه‌ای که آماده کرده‌اید را وارد کنید.

🧠 در پشت صحنه: اسکریپت از این دامنه برای دریافت خودکار گواهی SSL/TLS استفاده می‌کند. این گواهی برای رمزنگاری و شبیه‌سازی ترافیک به یک اتصال HTTPS استاندارد، ضروری است.

Port: پورت 443 را وارد کنید.

Password: یک رمز عبور قوی و پیچیده تعریف کنید.

فعال‌سازی پنهان‌سازی:

به سوالات مربوط به Obfuscation و Masquerade پاسخ مثبت (y) بدهید.

🧠 در پشت صحنه: قابلیت Masquerade مهم‌ترین بخش پنهان‌سازی است. این کار ترافیک شما را پشت یک وب‌سایت معتبر مخفی می‌کند و شناسایی سرور شما را بسیار دشوار می‌سازد.

🇮🇷 فصل ۴: پیکربندی سرور داخلی (Gateway Server)
در ترمینال سرور داخلی، گزینه 2. Install Hysteria As A Client را انتخاب کنید.

وارد کردن اطلاعات سرور:

اطلاعات سرور خارجی (دامنه، پورت و رمز عبور) را که در مرحله قبل تعریف کردید، وارد نمایید.

به سوالات Obfuscation و Masquerade نیز مطابق با تنظیمات سرور، پاسخ مثبت (y) بدهید.

تنظیم پورت فورواردینگ (Port Forwarding):

در این بخش، پورت‌هایی که پنل‌های شما (مانند Xray) روی آن‌ها فعال هستند را وارد کنید.

می‌توانید چند پورت را با کاما (,) از هم جدا کنید (مثال: 2096,8443).

🧠 در پشت صحنه: اسکریپت با استفاده از iptables قوانینی را تنظیم می‌کند که هر ترافیکی که به این پورت‌ها روی سرور داخلی وارد شود را به سمت تانل Hysteria هدایت می‌کند.

✅ فصل ۵: مدیریت و اعتبارسنجی نهایی
برای مدیریت سرویس (مشاهده وضعیت، ری‌استارت یا بررسی لاگ‌ها)، می‌توانید از گزینه 4. Hysteria Menu در منوی اصلی اسکریپت استفاده کنید.

تست نهایی عملکرد تانل:
برای اطمینان از صحت عملکرد، دستور زیر را در ترمینال سرور داخلی (ایران) اجرا کنید:

Bash

curl ifconfig.me
